<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>InvestHub System Documentation</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
    rel="stylesheet">
  <style>
    /* ---------- MODERN THEME VARIABLES ---------- */
    :root {
      --primary-50: #eff6ff;
      --primary-100: #dbeafe;
      --primary-500: #3b82f6;
      --primary-600: #2563eb;
      --primary-700: #1d4ed8;
      --primary-800: #1e40af;
      --secondary-50: #f0f9ff;
      --secondary-100: #e0f2fe;
      --secondary-500: #0ea5e9;
      --secondary-600: #0284c7;
      --neutral-50: #f8fafc;
      --neutral-100: #f1f5f9;
      --neutral-200: #e2e8f0;
      --neutral-300: #cbd5e1;
      --neutral-700: #334155;
      --neutral-800: #1e293b;
      --neutral-900: #0f172a;
      --success-500: #10b981;
      --warning-500: #f59e0b;
      --danger-500: #ef4444;
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 16px;
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
      --transition-all: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* ---------- RESET & GLOBAL ---------- */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      display: flex;
      height: 100vh;
      background: linear-gradient(135deg, var(--neutral-50) 0%, var(--primary-50) 100%);
      color: var(--neutral-900);
      overflow: hidden;
      font-family: 'Inter', system-ui, sans-serif;
      font-size: 16px;
      line-height: 1.7;
    }

    /* ---------- SIDEBAR ---------- */
    .sidebar {
      width: 280px;
      background: linear-gradient(160deg, var(--neutral-900) 0%, var(--neutral-800) 100%);
      color: #fff;
      padding: 24px 20px;
      border-right: 1px solid var(--neutral-700);
      display: flex;
      flex-direction: column;
      transition: var(--transition-all);
      overflow-y: auto;
      box-shadow: var(--shadow-lg);
      position: relative;
      z-index: 100;
    }

    .sidebar::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary-500), var(--secondary-500));
    }

    .sidebar h1 {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 28px;
      text-align: center;
      letter-spacing: -0.5px;
      background: linear-gradient(90deg, #fff, var(--primary-100));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .sidebar ul {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .sidebar a {
      display: flex;
      align-items: center;
      padding: 14px 16px;
      color: var(--neutral-300);
      font-size: 15px;
      font-weight: 500;
      text-decoration: none;
      border-radius: var(--radius-md);
      transition: var(--transition-all);
      position: relative;
      overflow: hidden;
    }

    .sidebar a::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 3px;
      background: var(--primary-500);
      transform: scaleY(0);
      transition: var(--transition-all);
    }

    .sidebar a:hover {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      padding-left: 20px;
      transform: translateX(2px);
    }

    .sidebar a:hover::before {
      transform: scaleY(1);
    }

    .sidebar a.active {
      background: linear-gradient(90deg, rgba(59, 130, 246, 0.2), rgba(59, 130, 246, 0.1));
      color: white;
      font-weight: 600;
      border-left: 3px solid var(--primary-500);
    }

    .sidebar a:focus-visible {
      outline: 2px solid var(--primary-500);
      outline-offset: 2px;
    }

    .sidebar-backdrop {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.7);
      backdrop-filter: blur(4px);
      z-index: 1400;
    }

    /* ---------- CONTENT ---------- */
    .content {
      flex: 1;
      padding: 40px;
      background: transparent;
      overflow-y: auto;
      position: relative;
    }

    .content::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background:
        radial-gradient(circle at 10% 20%, rgba(59, 130, 246, 0.05) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(14, 165, 233, 0.05) 0%, transparent 20%);
      z-index: -1;
    }

    .content-container {
      max-width: 1400px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(12px);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
      border: 1px solid rgba(226, 232, 240, 0.8);
      overflow: hidden;
    }

    .content-inner {
      padding: 40px;
    }

    .content h2 {
      font-size: 28px;
      margin-bottom: 20px;
      font-weight: 700;
      color: var(--neutral-900);
      letter-spacing: -0.5px;
      position: relative;
      padding-bottom: 12px;
    }

    .content h2::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 60px;
      height: 4px;
      background: linear-gradient(90deg, var(--primary-500), var(--secondary-500));
      border-radius: 2px;
    }

    .content h3 {
      font-size: 20px;
      font-weight: 600;
      margin-top: 24px;
      margin-bottom: 12px;
      color: var(--neutral-800);
      letter-spacing: -0.2px;
    }

    .content p {
      margin-top: 12px;
      color: var(--neutral-700);
      line-height: 1.8;
    }

    .content ul {
      padding-left: 22px;
      margin-top: 12px;
    }

    .content li {
      margin: 8px 0;
      color: var(--neutral-700);
      line-height: 1.7;
      position: relative;
    }

    .content li::marker {
      color: var(--primary-500);
    }

    b,
    strong {
      font-weight: 600;
      color: var(--neutral-900);
    }

    .section {
      padding-bottom: 36px;
      margin-bottom: 36px;
      border-bottom: 1px solid var(--neutral-200);
      scroll-margin-top: 100px;
    }

    .section:last-child {
      border-bottom: none;
    }

    /* ---------- DIAGRAMS ---------- */
    .diagram {
      background: linear-gradient(145deg, #ffffff 0%, var(--neutral-50) 100%);
      padding: 28px;
      border-radius: var(--radius-lg);
      margin-top: 16px;
      border: 1px solid var(--neutral-200);
      min-height: 500px;
      box-shadow: var(--shadow-md);
      overflow: auto;
      position: relative;
    }

    .diagram::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary-500), var(--secondary-500), var(--success-500));
      border-radius: var(--radius-lg) var(--radius-lg) 0 0;
    }

    .diagram-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--neutral-200);
    }

    .diagram-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--neutral-800);
    }

    .diagram-badge {
      background: linear-gradient(90deg, var(--primary-500), var(--primary-600));
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .diagram-content {
      position: relative;
      z-index: 2;
    }

    .diagram svg {
      background: transparent !important;
      border-radius: var(--radius-md);
    }

    /* Mermaid theme override */
    .diagram :is(.node, .cluster) rect {
      fill: white;
      stroke: var(--primary-500);
      stroke-width: 2px;
      rx: 8px;
      ry: 8px;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
    }

    .diagram :is(.node, .cluster) text {
      fill: var(--neutral-900);
      font-family: 'Inter', sans-serif;
      font-weight: 500;
    }

    .diagram .edgePath path {
      stroke: var(--neutral-700) !important;
      stroke-width: 2px !important;
    }

    .diagram .edgeLabel rect {
      fill: var(--neutral-100) !important;
    }

    .diagram .edgeLabel text {
      fill: var(--neutral-800) !important;
      font-family: 'Inter', sans-serif !important;
      font-weight: 500 !important;
    }

    /* ---------- ALWAYS VISIBLE MOBILE BUTTON ---------- */
    .mobile-toggle {
      display: none;
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 2000;
      padding: 12px 16px;
      border-radius: var(--radius-md);
      background: linear-gradient(135deg, var(--primary-600), var(--primary-700));
      box-shadow: var(--shadow-lg);
      cursor: pointer;
      color: #fff;
      font-size: 16px;
      font-weight: 600;
      border: none;
      font: inherit;
      transition: var(--transition-all);
    }

    .mobile-toggle:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(37, 99, 235, 0.3);
    }

    .mobile-toggle:active {
      transform: translateY(0);
    }

    .mobile-toggle.hidden {
      display: none !important;
    }

    /* ---------- SCROLLBAR ---------- */
    ::-webkit-scrollbar {
      width: 10px;
      height: 10px;
    }

    ::-webkit-scrollbar-thumb {
      background: linear-gradient(var(--primary-500), var(--secondary-500));
      border-radius: 5px;
      border: 2px solid transparent;
      background-clip: content-box;
    }

    ::-webkit-scrollbar-track {
      background: var(--neutral-100);
      border-radius: 5px;
    }

    ::-webkit-scrollbar-corner {
      background: var(--neutral-100);
    }

    /* ---------- RESPONSIVE BREAKPOINT ---------- */
    @media(max-width: 1024px) {
      body {
        flex-direction: column;
        height: auto;
        overflow-y: auto;
      }

      .mobile-toggle {
        display: flex;
        align-items: center;
        gap: 8px;
        top: 16px;
        left: 16px;
      }

      .sidebar {
        position: fixed;
        height: 100dvh;
        /* Dynamic viewport height */
        transform: translateX(-100%);
        top: 0;
        left: 0;
        z-index: 1500;
        width: 280px;
        box-shadow: none;
      }

      .sidebar.open {
        transform: translateX(0);
        box-shadow: 20px 0 50px rgba(0, 0, 0, 0.3);
      }

      .sidebar-backdrop.open {
        display: block;
        backdrop-filter: blur(8px);
        background: rgba(15, 23, 42, 0.6);
      }

      .content {
        padding: 70px 16px 40px 16px;
        overflow: visible;
        flex: none;
      }

      .content-container {
        border-radius: var(--radius-md);
        box-shadow: var(--shadow-md);
        border: 1px solid rgba(255, 255, 255, 0.5);
      }

      .content-inner {
        padding: 24px 20px;
      }

      .diagram {
        min-height: 400px;
        padding: 16px;
        /* Allow horizontal scroll on mobile */
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      .content h2 {
        font-size: 24px;
      }

      .content h3 {
        font-size: 18px;
      }
    }

    /* ---------- HOME PAGE STYLING ---------- */
    .hero {
      background: linear-gradient(135deg, var(--primary-50) 0%, var(--secondary-50) 100%);
      padding: 32px;
      border-radius: var(--radius-lg);
      margin-bottom: 32px;
      border-left: 5px solid var(--primary-500);
      box-shadow: var(--shadow-md);
      position: relative;
      overflow: hidden;
    }

    .hero::before {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 100px;
      height: 100px;
      background: radial-gradient(circle, rgba(59, 130, 246, 0.1) 0%, transparent 70%);
      border-radius: 50%;
    }

    .hero-content {
      position: relative;
      z-index: 2;
    }

    .hero h2 {
      font-size: 32px;
      margin-bottom: 12px;
      font-weight: 700;
      color: var(--neutral-900);
      letter-spacing: -1px;
    }

    .hero p {
      color: var(--neutral-700);
      line-height: 1.7;
      font-size: 18px;
      max-width: 800px;
    }

    .highlights {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 24px;
      margin-bottom: 40px;
    }

    .card {
      background: linear-gradient(145deg, #ffffff 0%, var(--neutral-50) 100%);
      border-radius: var(--radius-lg);
      padding: 24px;
      border: 1px solid var(--neutral-200);
      box-shadow: var(--shadow-md);
      transition: var(--transition-all);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--primary-500), var(--secondary-500));
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-lg);
      border-color: var(--primary-200);
    }

    .card h3 {
      margin-bottom: 16px;
      font-weight: 600;
      color: var(--neutral-800);
      font-size: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card-icon {
      width: 24px;
      height: 24px;
      background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 14px;
    }

    .card ul {
      padding-left: 0;
    }

    .card li {
      line-height: 1.7;
      margin: 10px 0;
      padding-left: 24px;
      position: relative;
    }

    .card li::before {
      content: '‚Üí';
      position: absolute;
      left: 0;
      color: var(--primary-500);
      font-weight: 600;
    }

    .quicklinks {
      background: linear-gradient(135deg, var(--neutral-50) 0%, #ffffff 100%);
      padding: 28px;
      border-radius: var(--radius-lg);
      border: 1px solid var(--neutral-200);
      box-shadow: var(--shadow-sm);
    }

    .quicklinks h3 {
      margin-bottom: 20px;
      font-weight: 600;
      color: var(--neutral-800);
      font-size: 20px;
    }

    .quick-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .quick-buttons a {
      background: linear-gradient(135deg, var(--primary-600), var(--primary-700));
      color: white;
      padding: 12px 20px;
      border-radius: var(--radius-md);
      text-decoration: none;
      font-size: 15px;
      font-weight: 500;
      transition: var(--transition-all);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      box-shadow: var(--shadow-sm);
    }

    .quick-buttons a:hover {
      background: linear-gradient(135deg, var(--primary-700), var(--primary-800));
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .quick-buttons a::after {
      content: '‚Üó';
      font-size: 12px;
    }

    /* Mobile tweak */
    @media(max-width: 600px) {
      .hero {
        padding: 24px 20px;
      }

      .hero h2 {
        font-size: 26px;
      }

      .hero p {
        font-size: 16px;
      }

      .highlights {
        grid-template-columns: 1fr;
        /* Force single column */
        gap: 16px;
      }

      .card {
        padding: 20px;
      }

      .quick-buttons {
        flex-direction: column;
      }

      .quick-buttons a {
        width: 100%;
        justify-content: center;
      }

      .progress-imgs img {
        width: 100%;
        height: auto;
      }
    }

    /* ---------- PROGRESS PAGE ---------- */
    .progress-entry {
      background: linear-gradient(145deg, #ffffff 0%, var(--neutral-50) 100%);
      border: 1px solid var(--neutral-200);
      padding: 24px;
      margin-bottom: 24px;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
      transition: var(--transition-all);
    }

    .progress-entry:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-lg);
      border-color: var(--primary-200);
    }

    .progress-entry h3 {
      margin-bottom: 12px;
      color: var(--neutral-800);
      font-size: 20px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .progress-date {
      background: linear-gradient(90deg, var(--primary-100), var(--secondary-100));
      color: var(--primary-700);
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
    }

    .progress-imgs {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      margin-top: 16px;
    }

    .progress-imgs img {
      width: 260px;
      height: auto;
      border-radius: var(--radius-md);
      border: 2px solid var(--neutral-200);
      object-fit: cover;
      transition: var(--transition-all);
      box-shadow: var(--shadow-sm);
    }

    .progress-imgs img:hover {
      transform: scale(1.05) translateY(-5px);
      box-shadow: var(--shadow-lg);
      border-color: var(--primary-300);
      cursor: pointer;
    }

    /* ---------- CODE BLOCKS ---------- */
    pre {
      background: var(--neutral-900);
      color: var(--neutral-100);
      padding: 20px;
      border-radius: var(--radius-md);
      overflow-x: auto;
      font-family: 'JetBrains Mono', monospace;
      font-size: 14px;
      line-height: 1.6;
      box-shadow: var(--shadow-md);
      margin: 16px 0;
    }

    code {
      font-family: 'JetBrains Mono', monospace;
      background: var(--neutral-100);
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 14px;
      color: var(--primary-700);
    }
  </style>

  <script type="module">
    import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";
    mermaid.initialize({ startOnLoad: true });
  </script>
</head>

<body>
  <button class="mobile-toggle" type="button">‚ò∞ Menu</button>
  <div class="sidebar-backdrop"></div>
  <div class="sidebar" id="investhub-sidebar" role="navigation" aria-label="Primary">
    <h1>INVESTHUB</h1>
    <ul>
      <li><a href="#home">Home</a></li>
      <li><a href="#flowchart">Flowchart</a></li>
      <li><a href="#dfd">DFD</a></li>
      <li><a href="#activity">Activity</a></li>
      <li><a href="#sequence">Sequence</a></li>
      <li><a href="#uml">UML</a></li>
      <li><a href="#er">ER</a></li>
      <li><a href="#usecase">Use Case</a></li>
      <li><a href="#deployment">Deployment</a></li>
      <li><a href="#components">Components</a></li>
      <li><a href="#withdrawals">Withdrawals</a></li>
      <li><a href="#datadictionary">Data Dictionary</a></li>
      <li><a href="#api">API Endpoints</a></li>
      <li><a href="#glossary">Glossary</a></li>
    </ul>
  </div>

  <div class="content" id="content">
    <div class="content-container">
      <div class="content-inner">
        <section class="section" id="home">
          <section class="hero">
            <div class="hero-content">
              <h2>InvestHub ‚Äì System Documentation</h2>
              <p>A fully simulated investment and finance learning platform with deposits, withdrawals, admin actions,
                real-time updates, and automated profit allocation.</p>
            </div>
          </section>

          <section class="highlights">
            <div class="card">
              <h3><span class="card-icon">üë§</span> User Features</h3>
              <ul>
                <li>Deposit funds (Razorpay)</li>
                <li>Track balance &amp; transactions</li>
                <li>Request withdrawals</li>
                <li>Choose compound/payout mode</li>
                <li>Access learning content</li>
              </ul>
            </div>

            <div class="card">
              <h3><span class="card-icon">‚öôÔ∏è</span> Admin Features</h3>
              <ul>
                <li>Approve/Reject withdrawals</li>
                <li>Distribute profits</li>
                <li>View platform performance</li>
                <li>Upload content</li>
                <li>Block or manage users</li>
              </ul>
            </div>

            <div class="card">
              <h3><span class="card-icon">‚ö°</span> System Core</h3>
              <ul>
                <li>Secure authentication</li>
                <li>Atomic database transactions</li>
                <li>Real-time socket updates</li>
                <li>Email notifications</li>
                <li>Full audit transaction logs</li>
              </ul>
            </div>
          </section>

          <section class="quicklinks">
            <h3>Quick Navigation</h3>
            <div class="quick-buttons">
              <a href="#flowchart">Flowchart</a>
              <a href="#dfd">DFD</a>
              <a href="#uml">UML</a>
              <a href="#deployment">Deployment</a>
              <a href="#api">API Docs</a>
            </div>
          </section>
        </section>

        <section class="section" id="flowchart">
          <h2>System Architecture</h2>
          <div class="diagram">
            <div class="diagram-header">
              <div class="diagram-title">Platform Architecture & Data Flow</div>
              <div class="diagram-badge">Architecture</div>
            </div>
            <div class="diagram-content mermaid">
              flowchart TD
              %% Global Definitions
              classDef actor fill:#1e293b,stroke:#0f172a,color:#fff,rx:20,ry:20,font-weight:600;
              classDef ui fill:#eff6ff,stroke:#3b82f6,stroke-width:2px,color:#1e3a8a,rx:6,ry:6;
              classDef logic fill:#fff,stroke:#64748b,stroke-dasharray: 5 5,color:#334155,rx:4,ry:4;
              classDef db fill:#f0fdf4,stroke:#22c55e,stroke-width:2px,color:#14532d,shape:cyl;
              classDef ext fill:#fefce8,stroke:#f59e0b,stroke-width:2px,color:#78350f,rx:4,ry:4;

              %% Top Level Actors
              U((User)):::actor
              A((Admin)):::actor

              subgraph ClientApp ["Client Application"]
              direction TB
              Login[Authentication Module]:::ui

              subgraph Panels ["Interfaces"]
              UDash[User Dashboard]:::ui
              ADash[Admin Dashboard]:::ui
              end
              end

              subgraph CoreSystem ["Backend Core"]
              direction TB
              TxnProc[[Transaction Engine]]:::logic
              ContentMgr[[CMS Module]]:::logic
              NotifySvc[[Notification Service]]:::logic
              end

              subgraph DataLayer ["Persistence"]
              MainDB[(MongoDB Atlas)]:::db
              end

              subgraph Integrations ["External Services"]
              PG[Razorpay Gateway]:::ext
              SMTP[Email Server]:::ext
              end

              %% Relationships
              U & A ==> Login
              Login -.->|Verify Credentials| MainDB
              Login ==>|Role: User| UDash
              Login ==>|Role: Admin| ADash

              %% User Operations
              UDash -->|Deposit Request| PG
              PG -.->|Webhook: Payment Success| TxnProc
              TxnProc -->|Credit Wallet| MainDB
              TxnProc -->|Emit Event| NotifySvc

              UDash -->|Withdrawal Request| TxnProc
              TxnProc -->|Lock Funds| MainDB

              %% Admin Operations
              ADash -->|Approve Withdrawal| TxnProc
              TxnProc -->|Mark Settled| MainDB
              TxnProc -->|Trigger Email| NotifySvc

              ADash -->|Post Content| ContentMgr
              ContentMgr -->|Save Resource| MainDB

              %% System Feedback
              NotifySvc -->|Send Alert| SMTP
              SMTP -.->|Email Delivery| U

              %% Styling Links
              linkStyle default stroke:#64748b,stroke-width:2px,fill:none
            </div>
          </div>
        </section>

        <section class="section" id="dfd">
          <h2>Data Flow Diagrams</h2>

          <h3>DFD Level 0</h3>
          <div class="diagram">
            <div class="diagram-header">
              <div class="diagram-title">High-Level Data Flow</div>
              <div class="diagram-badge">Level 0</div>
            </div>
            <div class="diagram-content mermaid">
              flowchart LR
              %% Entities
              User[User]
              Admin[Admin]
              System(("InvestHub Platform"))
              Razorpay[Razorpay Gateway]
              Email[Email Service]
              Socket[Socket Service]

              %% Interactions
              User <-->|"Auth, Deposits, Withdrawals, Content"| System
                Admin <-->|"Approvals, Updates, Content Mgmt"| System

                  System <-->|"Payment Verification"| Razorpay
                    System -->|Notifications| Email
                    System -->|"Real-time Events"| Socket
            </div>
          </div>

          <h3>DFD Level 1</h3>
          <div class="diagram">
            <div class="diagram-header">
              <div class="diagram-title">Detailed Component Interactions</div>
              <div class="diagram-badge">Level 1</div>
            </div>
            <div class="diagram-content mermaid">
              flowchart TB
              %% Entities
              User[User]
              Admin[Admin]

              subgraph Processes ["Core Processes"]
              P1(("Auth System"))
              P2(("Finance Engine"))
              P3(("Admin Controls"))
              P4(("Notification Svc"))
              end

              subgraph Storage ["Data Stores"]
              UserDB[("Users")]
              WalletDB[("Wallets")]
              TxnDB[("Transactions")]
              ContentDB[("Content")]
              end

              %% Flows

              User -->|"Register/Login"| P1
              P1 <--> UserDB

                User -->|"Deposit/Withdraw"| P2
                P2 <--> WalletDB
                  P2 <--> TxnDB
                    P2 -->|Events| P4

                    Admin -->|"Review/Approve"| P3
                    P3 -->|"Update Status"| P2
                    P3 <--> ContentDB

                      P4 -->|Alerts| User
                      P4 -->|Reports| Admin
            </div>
          </div>

          <h3>DFD Level 2</h3>
          <div class="diagram">
            <div class="diagram-header">
              <div class="diagram-title">Finance (Deposits &amp; Withdrawals) ‚Äì Sub-Process Flow</div>
              <div class="diagram-badge">Level 2</div>
            </div>
            <div class="diagram-content mermaid">
              flowchart TB
              %% Sources
              User[User]
              Admin[Admin]
              PG[Razorpay]

              subgraph DepositFlow ["Deposit Process"]
              StartDep(Initiate) --> CreateOrder("Create Order")
              CreateOrder -->|"Order ID"| PG
              PG -->|Webhook| Verify("Verify Signature")
              Verify -->|Success| Credit("Credit Wallet")
              Credit --> LogTxn1("Log Transaction")
              end

              subgraph WithdrawFlow ["Withdrawal Process"]
              ReqWith(Request) --> CheckFunds{"Sufficient Funds?"}
              CheckFunds -- Yes --> Lock("Lock Funds")
              CheckFunds -- No --> Reject("Reject Request")
              Lock --> Pending("Create Pending Record")
              Pending --> AdminReview("Admin Decision")

              AdminReview -- Approve --> Settle("Settle Payment")
              AdminReview -- Reject --> Refund("Refund to Wallet")

              Settle --> LogTxn2("Log Transaction")
              Refund --> LogTxn2
              end

              User --> StartDep
              User --> ReqWith
              Admin --> AdminReview
            </div>
          </div>
        </section>

        <section class="section" id="activity">
          <h2>Activity Diagram</h2>
          <div class="diagram">
            <div class="diagram-header">
              <div class="diagram-title">Complete User Activity Flow</div>
              <div class="diagram-badge">Activity</div>
            </div>
            <div class="diagram-content mermaid">
              flowchart TD
              subgraph Visitor ["Visitor Phase"]
              Start((Start)) --> SignUp["Sign Up"]
              SignUp --> Login[Login]
              end

              subgraph ActiveUser ["Active User Phase"]
              Login --> Dashboard["User Dashboard"]

              Dashboard -->|Action| PerformKYC["Complete KYC"]

              Dashboard -->|Action| Deposit["Deposit Funds"]
              Deposit -->|Payment| PaymentGateway
              PaymentGateway -->|Success| BalanceUpd["Balance Updated"]

              Dashboard -->|Action| Withdraw["Request Withdrawal"]
              Withdraw -->|Hold| PendingState["Pending Approval"]
              PendingState -->|Admin Action| Result{Outcome}
              Result -- Approved --> BankCredit["Money Sent"]
              Result -- Rejected --> RefundWallet["Refunded to Wallet"]

              Dashboard -->|Action| Learning["View Content"]
              end

              subgraph SystemActions ["System"]
              BalanceUpd --> Notification
              BankCredit --> Notification
              RefundWallet --> Notification
              end
            </div>
          </div>
        </section>

        <section class="section" id="sequence">
          <h2>System Sequence Diagrams</h2>

          <h3>Deposit Processing Sequence</h3>
          <div class="diagram">
            <div class="diagram-header">
              <div class="diagram-title">Payment Flow &amp; Verification</div>
              <div class="diagram-badge">Sequence</div>
            </div>
            <div class="diagram-content mermaid">
              sequenceDiagram
              autonumber
              actor User
              participant UI as Client (UI)
              participant API as Backend API
              participant PG as Razorpay Service
              participant DB as MongoDB
              participant NT as Notification System

              User->>UI: Enter Amount & Pay
              UI->>API: POST /deposit/create
              API->>PG: Create Order
              PG-->>API: Returns OrderId
              API-->>UI: Payment Config

              User->>PG: Complete Payment
              PG->>API: Webhook (payment.captured)

              activate API
              API->>API: Verify Signature (HMAC)
              API->>DB: Save Deposit Record
              API->>DB: Update Wallet Balance
              API->>DB: Create Transaction Log

              par Notifications
              API->>NT: Trigger Email Receipt
              API->>NT: Emit Socket Event (Balance Update)
              end
              deactivate API

              NT-->>UI: Push Notification (Success)
              UI->>User: Show "Payment Successful"
            </div>
          </div>

          <h3>Withdrawal Processing Sequence</h3>
          <div class="diagram">
            <div class="diagram-header">
              <div class="diagram-title">Request Handling &amp; Approval</div>
              <div class="diagram-badge">Sequence</div>
            </div>
            <div class="diagram-content mermaid">
              sequenceDiagram
              autonumber
              actor User
              participant UI as Client (UI)
              participant API as Backend API
              participant DB as MongoDB
              actor Admin
              participant NT as Notification System

              User->>UI: Request Withdrawal
              UI->>API: POST /withdraw/request

              activate API
              API->>DB: Check Available Balance
              alt Insufficient Funds
              API-->>UI: Return Error
              else Sufficient Funds
              API->>DB: Deduct Balance (Lock Funds)
              API->>DB: Create Withdrawal (PENDING)
              API->>NT: Notify Admin (Socket)
              API-->>UI: Success Message
              end
              deactivate API

              NT-->>Admin: New Request Alert

              Admin->>API: POST /withdraw/approve
              activate API
              API->>DB: Update Withdrawal (APPROVED)
              API->>DB: Create Transaction Log
              API->>NT: Send Email & Update UI
              deactivate API

              NT-->>User: Withdrawal Approved Notification
            </div>
          </div>
        </section>

        <section class="section" id="uml">
          <h2>UML Class Diagram</h2>
          <div class="diagram">
            <div class="diagram-header">
              <div class="diagram-title">System Architecture &amp; Relationships</div>
              <div class="diagram-badge">Class Model</div>
            </div>
            <div class="diagram-content mermaid">
              classDiagram
              %% Core Entities
              class User {
              +ObjectId _id
              +String name
              +String email
              +String passwordHash
              +Role role
              +String referralCode
              +Status status
              }

              class Wallet {
              +ObjectId userId
              +Double balance
              +Double lockedFunds
              +Double totalDeposited
              +Double totalWithdrawn
              +credit(amount)
              +debit(amount)
              }

              class Transaction {
              +ObjectId userId
              +Enum type
              +Double amount
              +Enum status
              +String referenceId
              +Date createdAt
              }

              class Deposit {
              +ObjectId userId
              +Double amount
              +String razorpayOrderId
              +String razorpayPaymentId
              +Enum status
              }

              class Withdrawal {
              +ObjectId userId
              +Double amount
              +Enum status
              +String adminRemark
              +Date processedAt
              }

              class KYC {
              +ObjectId userId
              +String documentUrl
              +Enum type
              +Enum status
              }

              class Notification {
              +ObjectId userId
              +String title
              +String message
              +Boolean isRead
              }

              %% Relationships
              User "1" -- "1" Wallet : owns
              User "1" -- "1" KYC : submits
              User "1" -- "*" Transaction : history
              User "1" -- "*" Notification : receives
              Wallet "1" -- "*" Deposit : receives
              Wallet "1" -- "*" Withdrawal : sources
            </div>
          </div>
        </section>

        <section class="section" id="er">
          <h2>Entity Relationship Diagram</h2>
          <div class="diagram">
            <div class="diagram-header">
              <div class="diagram-title">Database Schema &amp; Relationships</div>
              <div class="diagram-badge">ER Model</div>
            </div>
            <div class="diagram-content mermaid">
              erDiagram
              USERS ||--|| WALLETS : possesses
              USERS ||--|| KYC_RECORDS : has
              USERS ||--o{ TRANSACTIONS : generates
              USERS ||--o{ DEPOSITS : initiates
              USERS ||--o{ WITHDRAWALS : requests
              USERS ||--o{ NOTIFICATIONS : receives

              USERS {
              ObjectId _id PK
              String email
              String name
              Enum role "USER|ADMIN"
              }

              WALLETS {
              ObjectId _id PK
              ObjectId user_id FK
              Double balance
              Double locked_amount
              }

              TRANSACTIONS {
              ObjectId _id PK
              ObjectId user_id FK
              String type
              Double amount
              Date timestamp
              }

              WITHDRAWALS {
              ObjectId _id PK
              ObjectId user_id FK
              Double amount
              String status "PENDING|APPROVED|REJECTED"
              }
            </div>
          </div>
        </section>

        <section class="section" id="usecase">
          <h2>Use Case Diagram</h2>
          <div class="diagram">
            <div class="diagram-header">
              <div class="diagram-title">Functional Requirements &amp; Actors</div>
              <div class="diagram-badge">Use Cases</div>
            </div>
            <div class="diagram-content mermaid">
              flowchart LR
              %% Actors
              User((User))
              Admin((Admin))
              System((InvestHub))

              %% User Cases
              subgraph UserFeatures ["User Features"]
              Reg["Register / Login"]
              Dep["Deposit Funds"]
              With["Withdraw Funds"]
              View["View Dashboard"]
              end

              %% Admin Cases
              subgraph AdminFeatures ["Admin Features"]
              Approve["Approve Withdrawals"]
              Manage["Manage Users"]
              Upload["Upload Content"]
              end

              %% Connections
              User --> Reg
              User --> Dep
              User --> With
              User --> View

              Admin --> Approve
              Admin --> Manage
              Admin --> Upload

              %% System Responsibilities
              System -.->|Verifies| Dep
              System -.->|Notifies| User
              System -.->|Records| With
            </div>
          </div>
        </section>



        <section class="section" id="withdrawals">
          <h2>Withdrawal State Machine</h2>
          <div class="diagram">
            <div class="diagram-header">
              <div class="diagram-title">Request Lifecycle & Transitions</div>
              <div class="diagram-badge">State Machine</div>
            </div>
            <div class="diagram-content mermaid">
              stateDiagram-v2
              [*] --> Initiated: User Requests
              Initiated --> Pending: Funds Locked

              state AdminDecision {
              Pending --> Approved: Valid Request
              Pending --> Rejected: Invalid Request
              }

              Approved --> Settled: Funds Transferred
              Rejected --> Refunded: Balance Restored

              Settled --> [*]
              Refunded --> [*]

              note right of Pending
              Admin is notified
              Funds are not usable
              end note
            </div>
          </div>
        </section>

        <section class="section" id="datadictionary">
          <h2>Data Dictionary</h2>

          <p>The following tables explain every key field in the database:</p>

          <h3>Users Collection</h3>
          <ul>
            <li><b>name</b>: Full display name</li>
            <li><b>email</b>: Unique login identifier</li>
            <li><b>password</b>: Stored encrypted hash</li>
            <li><b>role</b>: USER / ADMIN</li>
            <li><b>status</b>: ACTIVE / BLOCKED</li>
            <li><b>payoutPreference</b>: COMPOUND or PAYOUT</li>
            <li><b>referralCode</b>: Generated unique code</li>
          </ul>

          <h3>Wallet Collection</h3>
          <ul>
            <li><b>balance</b>: Principal + compounded growth</li>
            <li><b>payoutWalletBalance</b>: Withdrawable profit</li>
            <li><b>totalDeposited</b>: Lifetime sum of deposits</li>
            <li><b>totalWithdrawn</b>: Lifetime sum of withdrawals</li>
            <li><b>totalProfit</b>: Lifetime earned profits</li>
          </ul>

          <h3>Transactions Collection</h3>
          <ul>
            <li><b>type</b>: DEPOSIT, WITHDRAWAL, PROFIT</li>
            <li><b>status</b>: PENDING, SUCCESS, FAILED</li>
            <li><b>referenceId</b>: Points to related record</li>
            <li><b>description</b>: Optional narrative</li>
          </ul>
        </section>

        <section class="section" id="api">
          <h2>API Endpoints</h2>

          <h3>Authentication Services</h3>
          <ul>
            <li><b>POST /api/auth/register</b> ‚Äì Create account</li>
            <li><b>POST /api/auth/login</b> ‚Äì Login</li>
          </ul>

          <h3>User Financial Operations</h3>
          <ul>
            <li><b>POST /api/finance/deposit/create</b> ‚Äì Create Razorpay order</li>
            <li><b>POST /api/finance/deposit/verify</b> ‚Äì Validate payment</li>
            <li><b>POST /api/finance/withdraw</b> ‚Äì Request withdrawal</li>
            <li><b>GET /api/finance/transactions</b> ‚Äì Fetch user txns</li>
          </ul>

          <h3>Admin Management</h3>
          <ul>
            <li><b>GET /api/admin/withdrawals</b> ‚Äì Pending list</li>
            <li><b>POST /api/admin/withdraw/manage</b> ‚Äì Approve/Reject</li>
            <li><b>POST /api/admin/profit</b> ‚Äì Distribute profit</li>
            <li><b>POST /api/admin/content</b> ‚Äì Upload learning</li>
          </ul>

          <h3>Internal Core Services</h3>
          <ul>
            <li><b>POST /api/internal/socket</b> ‚Äì Broadcast updates</li>
            <li><b>POST /api/internal/email</b> ‚Äì Send E-mail</li>
          </ul>
        </section>

        <section class="section" id="glossary">
          <h2>Technical Glossary</h2>

          <ul>
            <li><b>Admin:</b> Manager with approval powers</li>
            <li><b>Balance:</b> Principal + compound growth</li>
            <li><b>Payout Wallet:</b> Withdrawable profit reserve</li>
            <li><b>Compound:</b> Add profit back to capital</li>
            <li><b>Pending Withdrawal:</b> Waiting admin approval</li>
            <li><b>Rejected Withdrawal:</b> Locked amount refunded</li>
            <li><b>Razorpay:</b> Payment gateway interface</li>
            <li><b>NextAuth:</b> Authentication middleware</li>
            <li><b>Mongoose:</b> MongoDB ORM layer</li>
            <li><b>Socket.io:</b> Live real-time bulletins</li>
            <li><b>Nodemailer:</b> SMTP email service</li>
            <li><b>Profit Distribution:</b> Manual admin issue of earnings</li>
          </ul>
        </section>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const sidebar = document.querySelector(".sidebar");
        const toggleBtn = document.querySelector(".mobile-toggle");
        const backdrop = document.querySelector(".sidebar-backdrop");
        const content = document.getElementById("content");

        const setOpen = (open) => {
          sidebar.classList.toggle("open", open);
          backdrop.classList.toggle("open", open);
          toggleBtn.classList.toggle("hidden", open);
          toggleBtn.setAttribute("aria-expanded", String(open));
        };

        toggleBtn.setAttribute("aria-controls", "investhub-sidebar");
        toggleBtn.setAttribute("aria-expanded", "false");

        toggleBtn.addEventListener("click", () => {
          setOpen(!sidebar.classList.contains("open"));
        });

        backdrop.addEventListener("click", () => setOpen(false));

        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape") setOpen(false);
        });

        const links = Array.from(sidebar.querySelectorAll('a[href^="#"]'));
        const setActive = () => {
          const hash = (window.location.hash || "#home").toLowerCase();
          links.forEach((a) => {
            a.classList.toggle("active", (a.getAttribute("href") || "").toLowerCase() === hash);
          });
        };

        if (!window.location.hash) {
          history.replaceState(null, "", "#home");
        }
        setActive();

        window.addEventListener("hashchange", () => {
          setActive();
        });

        sidebar.addEventListener("click", (e) => {
          const a = e.target && e.target.closest ? e.target.closest('a[href^="#"]') : null;
          if (!a) return;
          if (window.innerWidth <= 1024) setOpen(false);
        });

        content.addEventListener("click", () => {
          if (window.innerWidth <= 1024) setOpen(false);
        });

        const sectionIds = links
          .map((a) => (a.getAttribute("href") || "").slice(1))
          .filter(Boolean);

        const sections = sectionIds
          .map((id) => document.getElementById(id))
          .filter(Boolean);

        if ("IntersectionObserver" in window) {
          const observer = new IntersectionObserver(
            (entries) => {
              const visible = entries
                .filter((e2) => e2.isIntersecting)
                .sort((a, b) => b.intersectionRatio - a.intersectionRatio)[0];

              if (!visible || !visible.target || !visible.target.id) return;
              history.replaceState(null, "", `#${visible.target.id}`);
              setActive();
            },
            { root: content, threshold: [0.2, 0.35, 0.5] }
          );

          sections.forEach((s) => observer.observe(s));
        }
      });
    </script>
</body>

</html>